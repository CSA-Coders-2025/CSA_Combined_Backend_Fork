<!DOCTYPE HTML>
<html xmlns:layout="http://www.w3.org/1999/xhtml" xmlns:th="http://www.w3.org/1999/xhtml"
      layout:decorate="~{layouts/base}" lang="en">
<head>
      <script>
        // Function to check if an image exists by loading it
        function imageExists(url) {
            var img = new Image();
            img.onload = function() {
                return true;
            };
            img.onerror = function() {
                return false;
            };
            img.src = url;
        }

        // Function to dynamically update the profile picture link
        function updateProfilePicture(personId) {
            var imgUrl = 'https://github.com/' + personId + '.png';
            var link = document.getElementById('profile-link-' + personId);
            var img = document.getElementById("pfp");

            // If the image exists, set the link to the profile picture; otherwise, remove the link
            if (imageExists(imgUrl)) {
                link.href = imgUrl;
            } else {
                link.removeAttribute('href');
            }
        }

        window.addEventListener("load",()=>{
            var personIds = document.querySelectorAll('[data-person-id]');
            personIds.forEach(function(element) {
                var personId = element.getAttribute('data-person-id');
                updateProfilePicture(personId);
            });

            document.getElementById("pfp-preview").src = document.getElementById("pfp").src;
            
            function getRandomInt(min, max) {
                const minCeiled = Math.ceil(min);
                const maxFloored = Math.floor(max);
                return Math.floor(Math.random() * (maxFloored - minCeiled) + minCeiled); // The maximum is exclusive and the minimum is inclusive
            }


            var randomInt = getRandomInt(1,6);

            var answer = "";

            switch (randomInt) {
                case 1:
                    answer = document.getElementById("id").innerText;
                    document.getElementById("question").innerHTML = "What is this user's: "+ "Id".bold()+"?";
                    break;
                case 2:
                    answer = document.getElementById("ghid").innerText;
                    document.getElementById("question").innerHTML = "What is this user's: "+ "Github Username".bold()+"?";
                    break;
                case 3:
                    answer = document.getElementById("name").innerText;
                    document.getElementById("question").innerHTML = "What is this user's: "+ "Display Name".bold()+"?";
                    break;
                case 4:
                    answer = document.getElementById("kasmServerNeeded").innerText;
                    document.getElementById("question").innerHTML = "What is this user's: "+ "Kasm Server Needed Status".bold()+"?";
                    break;
                case 5:
                answer = document.getElementById("studentId").innerText;
                    document.getElementById("question").innerHTML = "What is this user's: "+ "Student Id".bold()+"?";
                    break;
                default:
                    console.warn("something went wrong");
                    break;
            }

            document.getElementById("table").remove();

            document.getElementById("submitGuess").addEventListener("click",()=>{
                if(document.getElementById("inputField").value == answer){
                    document.getElementById("footerInfo").style.color = "green";
                    document.getElementById("footerInfo").innerText = "You are Correct! Reload page to play again.";
                }else{
                    document.getElementById("footerInfo").style.color = "Red";
                    document.getElementById("footerInfo").innerText = "Incorrect! The Correct Answer was: "+answer+". Reload page to play again.";
                }
                document.getElementById("submitGuess").remove();
            })
        });
    </script>
</head>

<body>
    <th:block layout:fragment="body" th:remove="tag">
        <div class="container py-4 bg-primary">
            <div class="container py-4 text-light bg-success">
                <div class="row align-items-md-stretch">
                    <table class="table" style="display:none;" id="table">
                        <tbody>
                            <tr th:object="${person}">
                                <td th:text="${person.id}" id="id">Person ID</td>
                                <td> 
                                    <div class="profile-picture-container">
                                        <!-- Profile picture with fallback image on error -->
                                        <a id="profile-link-${person.id}" data-person-id="${person.id}" target="_blank">
                                            <img id="pfp" th:src="|https://github.com/${person.ghid}.png|"
                                                 alt="Profile Picture"
                                                 onerror="this.onerror=null; this.src='https://github.com/user-attachments/assets/13dec9b2-21d6-458e-b099-f5f85ae9caf2';" />
                                        </a>
                                    </div>
                                </td>    
                                <td th:text="${person.ghid}" id="ghid">Person ID</td>
                                <td th:text="${person.name}" id="name">Name</td>
                                <td th:text="${person.kasmServerNeeded}" id="kasmServerNeeded">Kasm Server Needed</td>
                                <td th:text="${person.studentId}" id="studentId">Student Id</td>
                            </tr>
                        </tbody>
                    </table>
                    <h1>Person Quiz</h1>
                    <img id="pfp-preview" src="" alt="GitHub Profile Picture" style="max-width: 100px;">
                    <div>
                        <h3 id="question"></h3>
                        <input id="inputField" type="text" placeholder="Input Guess Here"/>
                        <button type="button" id="submitGuess">submit guess</button>
                        <h4 id="footerInfo"><h4>
                    </div>
                </div>
            </div>
        </div>
    </th:block>
</body>

</html>
